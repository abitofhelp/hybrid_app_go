@startuml 01_layer_dependencies
!theme plain
skinparam linetype ortho
skinparam nodesep 80
skinparam ranksep 100

title Hybrid_App_Ada - 5-Layer Architecture\nHexagonal (Ports & Adapters) + Clean + DDD

package "Bootstrap Layer" as Bootstrap #FFEBCD {
  note right of Bootstrap
    **Composition Root**
    - Wires all dependencies
    - Generic instantiation
    - Application lifecycle
    - Can depend on ALL layers
  end note
}

package "Presentation Layer" as Presentation #FFE4E1 {
  component "CLI" as CLI
  component "Controllers" as Controllers
  note right of Presentation
    **Driving Adapters**
    - User interfaces (CLI, API)
    - Request/response mapping
    - **Depends ONLY on Application**
    - **CANNOT access Domain**
  end note
}

package "Infrastructure Layer" as Infrastructure #E6F3FF {
  component "Adapters" as Adapters
  component "File System" as FileSystem
  note right of Infrastructure
    **Driven Adapters**
    - Implements Output Ports
    - External system integration
    - Depends on Application + Domain
  end note
}

package "Application Layer" as Application #E8F5E9 {
  component "Use Cases" as UseCases
  component "Ports" as Ports
  component "Application.Error" as AppError #FFFF99
  note right of Application
    **Orchestration Layer**
    - Coordinates domain logic
    - Defines Input/Output Ports
    - Re-exports Domain types
    - **Depends ONLY on Domain**
  end note
  note bottom of AppError
    Re-exports Domain.Error
    for Presentation layer
  end note
}

package "Domain Layer" as Domain #FFF9E6 {
  component "Entities" as Entities
  component "Value Objects" as VOs
  component "Domain.Error" as DomainError
  note right of Domain
    **Business Logic Core**
    - Pure domain concepts
    - Zero dependencies
    - Shareable across apps
  end note
}

' Dependencies - ALL point INWARD (center-seeking)
Bootstrap -down-> Presentation : wires
Bootstrap -down-> Infrastructure : wires
Bootstrap -down-> Application : wires
Bootstrap -down-> Domain : wires

Presentation -down-> Application : calls Input Ports\nuses Application.Error
Presentation -[hidden]down-> Domain

Infrastructure -down-> Application : implements Output Ports
Infrastructure -down-> Domain : uses Entities/VOs

Application -down-> Domain : orchestrates

' Critical boundaries
note on link
  ✅ ALLOWED
  Uses Application.Error
  (not Domain.Error)
end note

' Forbidden dependency
Presentation .right.> Domain #red : ❌ FORBIDDEN\nNo transitive access

legend right
  **Key Architectural Rules**
  ═══════════════════════════════
  ✅ **Presentation → Application ONLY**
     (no transitive Domain access)
  ✅ Infrastructure → Application + Domain
  ✅ Application → Domain
  ✅ Bootstrap → ALL (composition root)

  ❌ **NO** Presentation → Domain
  ❌ **NO** Presentation ↔ Infrastructure
  ❌ **NO** Domain → anything

  **Domain is the ONLY shareable layer**
  across multiple applications
endlegend

@enduml
